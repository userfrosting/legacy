---
title: Backend AJAX API
taxonomy:
    category: docs
---

These are pages which accept a POST or GET request (usually via AJAX), perform some action, and then return a response in the form of a JSON object. All backend api pages are stored in the `api` directory. Success, error, and warning messages are sent to the [alert stream](/0.2.2/features#errors), and can be accessed via `api/user_alerts.php`.

#### `activate_account.php`

Activates a newly registered user account, using the activation token that was emailed to the user upon account registration or user's `user_id` (`id` column in `users`).

**Login required:** no

**GET request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>[token]</code></td><td>The user's activation token, as generated during account registration or after a resend activation request.</td></tr>
<tr><td><code>[user_id]</code></td><td>The user's id.  Used for admins to bypass the activation token and directly activate a user's account.</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>

**GET response**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `ACCOUNT_INVALID_USER_ID` : Invalid user_id specified.
- `ACCOUNT_TOKEN_NOT_FOUND` : Invalid token specified.
- `SQL_ERROR` : Database error.
- `ACCOUNT_ACTIVATION_COMPLETE` : Account successfully activated.
- `ACCOUNT_MANUALLY_ACTIVATED` : Manual account activation successful.
- Authorization failed

#### `create_action_permit.php`

Adds a new [action-permit mapping](/0.2.2/features#authorization) for a user or group.

**Login required:** yes

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>action_name</code></td><td>The name of the secure action to be added for the specified user/group.</td></tr>
<tr><td><code>permit</code></td><td>A string of permit validators, joined by <code>&</code>.</td></tr>
<tr><td><code>[group_id]</code></td><td>If specified, the action-permit mapping will be added for this group.</td></tr>
<tr><td><code>[user_id]</code></td><td>If specified, the action-permit mapping will be added for this user.</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>

**POST response**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table> 

**Possible alerts generated**

- Invalid user_id specified.
- Invalid token specified.
- `SQL_ERROR` : Database error.
- Invalid action specified.
- Invalid permit(s) specified.
- Authorization failed

#### `create_group.php`

Create a new [group](/0.2.2/components#groups).

**Login required:** yes

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>group_name</code></td><td>The name of the new group.</td></tr>
<tr><td><code>home_page_id</code></td><td>The id of the page (as specified in the <code>pages</code> database table) to use as the group's home page.</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>

**POST response**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `PERMISSION_NAME_IN_USE` : Group name already in use.
- `PERMISSION_CHAR_LIMIT` : Group name too short/long.
- `PERMISSION_CREATION_SUCCESSFUL` : Group successfully created.
- `SQL_ERROR` : Database error.
- Authorization failed

#### `create_user.php`

Create a new [user](/0.2.2/components#users).

**Login required:** sometimes

This page can be accessed in admin or registration mode. If accessed in admin mode, authorization for the `createUser` secure function will be required, and the session [CSRF token](/0.2.2/security#csrf) must be supplied. Otherwise, a new user account can be self-registered if registration is enabled in the **site settings**. In registration mode, all default groups will be added for the new user. Will fail if the root account has not yet been created.

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>user_name</code></td><td>The username of the new user.  Must be between 1 and 25 characters long, letters and numbers only (no whitespace)</td></tr>
<tr><td><code>display_name</code></td><td>The display name of the new user.  Could be used, for example, to store a user's real name.  Must be between 1 and 50 characters long.</td></tr>
<tr><td><code>email</code></td><td>The user's email address.  Required for sending activation and password recovery emails.  Must be between 1 and 150 characters and a valid email format.</td></tr>
<tr><td><code>[title]</code></td><td>The new user's title.  Can only be specified in admin mode.  In registration mode, the default title for new users (in <strong>site settings</strong>) will be used for the user's title.  Must be between 1 and 150 characters long.</td></tr>
<tr><td><code>password</code></td><td>The password for the new user.  Must be between 8 and 50 characters.</td></tr>
<tr><td><code>passwordc</code></td><td>The password for the new user.  Must match the `password` field.</td></tr>
<tr><td><code>[admin]</code></td><td>If specified and set to <b>true</b>, will put the request through in admin mode.</td></tr>
<tr><td><code>[add_groups]</code></td><td>A comma-separated string of <code>group_id</code>'s to be associated with the new user.  Will only be accepted in admin mode.</td></tr>
<tr><td><code>[csrf_token]</code></td><td>The csrf token for the user's session.  In admin mode, must be set or the request will automatically fail.</td></tr>
<tr><td><code>[skip_activation]</code></td><td>If set to <b>true</b>, will skip the activation step for the new user account.  Will only be recognized in admin mode.</td></tr>
<tr><td><code>[primary_group_id]</code></td><td>The <code>group_id</code> of the primary group for the new user.  Will only be recognized in admin mode.</td></tr>
<tr><td><code>[captcha]</code></td><td>The captcha code displayed on the registration form.  In registration mode, must be specified and correctly match the registration captcha or else the request will automatically fail.</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>

**POST response**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `ACCOUNT_USER_CHAR_LIMIT` : Username too short/long.
- `ACCOUNT_USER_INVALID_CHARACTERS` : Username must be letters and numbers only.
- `ACCOUNT_USERNAME_IN_USE` : Username already in use.
- `ACCOUNT_DISPLAY_CHAR_LIMIT` : Display name too short/long.
- `ACCOUNT_DISPLAYNAME_IN_USE` : Display name already in use. TODO: relax this restriction?
- `ACCOUNT_PASS_CHAR_LIMIT` : Password too short/long.
- `ACCOUNT_PASS_MISMATCH` : `password` and `passwordc` do not match.
- `ACCOUNT_INVALID_EMAIL` : Email is not a valid email address format.
- `ACCOUNT_EMAIL_IN_USE` : Email address already in use.
- `MAIL_ERROR` : Error sending activation email (if in registration mode).
- `CAPTCHA_FAIL` : Captcha did not match. (if in registration mode).
- `ACCOUNT_CREATION_COMPLETE` : Successfully completed user account setup.
- `ACCOUNT_REGISTRATION_COMPLETE_TYPE1` : Successfully created user account (no activation required).
- `ACCOUNT_REGISTRATION_COMPLETE_TYPE2` : Successfully created user account (activation required).
- `ACCOUNT_PERMISSION_ADDED` : Successfully added user to groups (if in admin mode).
- `NO_DATA` : No request data was received by the script.
- `SQL_ERROR` : Database error.
- Authorization failed

#### `delete_action_permit.php`

Delete an action-permit mapping for a user or group.

**Login required:** yes

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>type</code></td><td>The type of action-permit to delete.  Must be set to either <b>user</b> or <b>group</b>.</td></tr>
<tr><td><code>action_id</code></td><td>The id of the action-permit to delete (in either the <code>user_action_permits</code> or <code>group_action_permits</code> table).</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>
<p><strong>POST response</strong></p>
<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `SQL_ERROR` : Database error.
- Invalid type specified.
- Invalid action id specified.
- Successfully deleted action-permit mapping.
- Authorization failed

#### `delete_group.php`

Delete a group. Groups which have their `can_delete` field in the database set to **0** cannot be deleted. This is useful for certain default groups, such as users and admins.

**Login required:** yes

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>group_id</code></td><td>The id of the group to delete (in the <code>groups</code> table).</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>
<p><strong>POST response</strong></p>
<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `SQL_ERROR` : Database error.
- `CANNOT_DELETE_PERMISSION_GROUP` : Group is not deletable (`can_delete`=0).
- Invalid group id specified.
- `PERMISSION_DELETION_SUCCESSFUL_NAME` : Group successfully deleted.
- Authorization failed

#### `delete_user.php`

Permanently delete a user account. To temporarily disable a user account instead, use the `update_user.php` api with `enabled` set to **false**. Note also that the root account cannot be deleted.

**Login required:** yes

**POST request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>user_id</code></td><td>The id of the user to delete (in the <code>users</code> table).</td></tr>
<tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
</tbody>
</table>
<p><strong>POST response</strong></p>
<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
<tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `SQL_ERROR` : Database error.
- `ACCOUNT_DELETE_MASTER` : The root account cannot be deleted.
- Invalid user id specified.
- `ACCOUNT_DELETIONS_SUCCESSFUL` : User account successfully deleted.
- Authorization failed

#### `load_action_permits.php`

Load a list of action-permits for one or more user(s) or group(s).

**Login required:** yes

**AJAX only:** yes

**GET request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code>[user_id]</code></td><td>If specified, loads a list of action-permits for the specified user.</td></tr>
<tr><td><code>[group_id]</code></td><td>If specified, loads a list of action-permits for the specified group.</td></tr>
<tr><td><code>[all]</code></td><td>If set to <b>users</b>, loads a list of action-permits for all users.  If set to <b>groups</b>, loads a list of action-permits for all groups.  Must be specified if neither <code>user_id</code> nor <code>group_id</code> is specified.</td></tr>        
<tr><td><code>[pretty]</code></td><td>If set to <b>true</b>, will output the resulting JSON object in a formatted and indented display.</td></tr>
</tbody>
</table>

**GET response**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>
<tr><td><code><i>JSON array</i></code></td><td>If <code>all</code> is specified, an array of objects representing groups and their associated action-permit mappings will be returned.  Each group will look something like the following code block.  Note that <code>action_permits</code> contains the array of action-permit mappings for the group.  Each action-permit mapping, in turn, contains the action name and an object containing associated permits.  Each permit, finally, consists of the permit validator name and an array of associated parameters.
<pre>
{
    "group_id": 1,
    "name": "User",
    "action_permits": [
        {
            "action_id": 3,
            "action": "loadUser",
            "permits": {
                "isLoggedInUser": [
                    "user_id"
                ]
            }
        },
        {
            "action_id": 1,
            "action": "updateUserEmail",
            "permits": {
                "isLoggedInUser": [
                    "user_id"
                ]
            }
        },
        ...
    ]
}
        </pre>
        If a <code>user_id</code> or <code>group_id</code> is specified, an array of action-permit objects will be returned.  In this mode, the permit strings will not be parsed out into their constituent validator functions.
        <pre>
[
	{
		"id": 3,
		"group_id": 1,
		"action": "loadUser",
		"permits": "isLoggedInUser(user_id)"
	},
	{
		"id": 4,
		"group_id": 1,
		"action": "loadUserGroups",
		"permits": "isLoggedInUser(user_id)"
	},
    ...
]
</pre>
</td></tr>
<tr><td><code>[errors[]]</code></td><td>the number of errors generated by the request, if it failed.</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `SQL_ERROR` : Database error.
- `user_id`, `group_id`, or `all` must be specified.
- Invalid `user_id`, `group_id`, or all value specified.
- Authorization failed

#### `load_current_user.php`

Load the currently logged-in user's information.

**Login required:** yes

**AJAX only:** yes

**GET request**

<table class="table table-bordered">
<thead><td>Variable name</td><td>Description</td></thead>
<tbody>        
<tr><td><code>user_id</code></td><td>The id of the currently logged in user.</td></tr>
<tr><td><code>user_name</code></td><td>The username of the currently logged in user.</td></tr>
<tr><td><code>display_name</code></td><td>The display name of the currently logged in user.</td></tr>
<tr><td><code>title</code></td><td>The title of the currently logged in user.</td></tr>
<tr><td><code>email</code></td><td>The email address of the currently logged in user.</td></tr>
<tr><td><code>sign_up_stamp</code></td><td>The UNIX timestamp (seconds since Jan 1, 1970) of the time when the currently logged in user's account was created.</td></tr>
<tr><td><code>last_sign_in_stamp</code></td><td>The UNIX timestamp (seconds since Jan 1, 1970) of the time when the currently logged in user's last logged in.</td></tr>
<tr><td><code>active</code></td><td><b>1</b> if the user's account is active, <b>0</b> otherwise.</td></tr>
<tr><td><code>enabled</code></td><td><b>1</b> if the user's account is enabled, <b>0</b> otherwise.</td></tr>
<tr><td><code>primary_group_id</code></td><td>The <code>group_id</code> of the user's primary group.</td></tr>
<tr><td><code>csrf_token</code></td><td>The currently logged in user's [CSRF token](0.2.2/security#csrf).</td></tr>
</tbody>
</table>

**Possible alerts generated**

- `SQL_ERROR`: Database error.
- User is not logged in.
